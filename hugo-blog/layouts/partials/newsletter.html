<div class="newsletter-box" id="newsletter">
  <div id="subscribe-section">
    <h3>Stay in the loop</h3>
    <p>I write about building and shipping products in India. No spam, just signal.</p>
    <form class="newsletter-form" id="newsletter-form">
      <div class="form-row">
        <input type="email" name="email" placeholder="you@company.com" required />
        <button type="submit">Subscribe</button>
      </div>
      <div class="newsletter-message" id="newsletter-message"></div>
    </form>
    <p class="newsletter-footer">
      <a href="#" id="show-unsubscribe">Unsubscribe</a>
    </p>
  </div>

  <div id="unsubscribe-section" style="display: none;">
    <h3>Unsubscribe</h3>
    <p>No hard feelings.</p>
    <form class="newsletter-form" id="unsubscribe-form">
      <div class="form-row">
        <input type="email" name="email" placeholder="you@company.com" required />
        <button type="submit">Unsubscribe</button>
      </div>
      <div class="newsletter-message" id="unsubscribe-message"></div>
    </form>
    <p class="newsletter-footer">
      <a href="#" id="show-subscribe">Back to subscribe</a>
    </p>
  </div>
</div>

<script>
(function() {
  const subscribeSection = document.getElementById('subscribe-section');
  const unsubscribeSection = document.getElementById('unsubscribe-section');

  document.getElementById('show-unsubscribe').addEventListener('click', function(e) {
    e.preventDefault();
    subscribeSection.style.display = 'none';
    unsubscribeSection.style.display = 'block';
  });

  document.getElementById('show-subscribe').addEventListener('click', function(e) {
    e.preventDefault();
    unsubscribeSection.style.display = 'none';
    subscribeSection.style.display = 'block';
  });

  // Subscribe form
  document.getElementById('newsletter-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const form = e.target;
    const button = form.querySelector('button');
    const messageEl = document.getElementById('newsletter-message');
    const email = form.querySelector('input[name="email"]').value;

    button.disabled = true;
    button.textContent = 'Subscribing...';
    messageEl.className = 'newsletter-message';
    messageEl.textContent = '';

    try {
      const response = await fetch('https://api.shipfast.blog/api/newsletter', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      });

      const data = await response.json();

      if (response.ok) {
        messageEl.className = 'newsletter-message success';
        messageEl.textContent = "You're in.";
        form.reset();
      } else {
        messageEl.className = 'newsletter-message error';
        messageEl.textContent = data.error || 'Something went wrong.';
      }
    } catch (err) {
      messageEl.className = 'newsletter-message error';
      messageEl.textContent = 'Network error. Try again.';
    }

    button.disabled = false;
    button.textContent = 'Subscribe';
  });

  // Unsubscribe form
  document.getElementById('unsubscribe-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const form = e.target;
    const button = form.querySelector('button');
    const messageEl = document.getElementById('unsubscribe-message');
    const email = form.querySelector('input[name="email"]').value;

    button.disabled = true;
    button.textContent = 'Unsubscribing...';
    messageEl.className = 'newsletter-message';
    messageEl.textContent = '';

    try {
      const response = await fetch('https://api.shipfast.blog/api/unsubscribe', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      });

      const data = await response.json();

      if (response.ok) {
        messageEl.className = 'newsletter-message success';
        messageEl.textContent = "You're out.";
        form.reset();
      } else {
        messageEl.className = 'newsletter-message error';
        messageEl.textContent = data.error || 'Something went wrong.';
      }
    } catch (err) {
      messageEl.className = 'newsletter-message error';
      messageEl.textContent = 'Network error. Try again.';
    }

    button.disabled = false;
    button.textContent = 'Unsubscribe';
  });
})();
</script>
